<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.farmfarm.myPageUser">

	<select id="myPageFundingList" parameterType="String"
		resultType="MyPageUserFundingVO">
		SELECT funding_thumb_img_url, product_name, farm_name,
		farm_address, user_funding_date, user_funding_amout, user_funding_pct,
		product_status
		FROM farm_and_product fp
		INNER JOIN funding_history fh ON
		fp.product_serial_num =
		fh.product_serial_num
		WHERE user_serial_num =
		#{user_serial_num}
	</select>

	<!-- 펀딩 달성률 가져오기 -->
	<select id = "myFundingRate" resultType="int">
		SELECT farm_and_product.product_serial_num,
		farm_and_product.product_name,
		round(funding_reg_info.target_total_amount/10000) AS min_amount,
		farm_and_product.expected_planting_date,
		farm_and_product.farm_square_footage,
		round(SUM(funding_history.user_funding_pct)) as funding_pct,
		DATEDIFF(funding_reg_info.funding_deadline, NOW()) as d_day,
		farm_and_product.funding_thumb_img_url
		FROM funding_history
		INNER JOIN farm_and_product
		ON funding_history.product_serial_num =
		farm_and_product.product_serial_num
		INNER JOIN funding_reg_info
		ON farm_and_product.product_serial_num =
		funding_reg_info.product_serial_num
		WHERE farm_and_product.product_status ='펀딩진행중'
		GROUP BY farm_and_product.product_serial_num
		ORDER BY SUM(funding_history.user_funding_pct) DESC LIMIT 6
	</select>

</mapper>